local Proxy = module("vrp","lib/Proxy")
vRP = Proxy.getInterface("vRP")
-----------------------------------------------------------------------------------------------------------------------------------------
-- VARIABLES
-----------------------------------------------------------------------------------------------------------------------------------------
local myQuerys = {}
-----------------------------------------------------------------------------------------------------------------------------------------
-- ONINIT
-----------------------------------------------------------------------------------------------------------------------------------------
local function onInit()
	return exports["oxmysql"] ~= nil
end
-----------------------------------------------------------------------------------------------------------------------------------------
-- ONPREPARE
-----------------------------------------------------------------------------------------------------------------------------------------
local function onPrepare(Name,Query)
	myQuerys[Name] = Query
end
-----------------------------------------------------------------------------------------------------------------------------------------
-- ONQUERY
-----------------------------------------------------------------------------------------------------------------------------------------
local function onQuery(Name,Results,Mode)
	local query = myQuerys[Name]
	query = query:gsub("%,",", ")
	local Params = { _ = true }

	for k,v in pairs(Results) do
		Params[k] = v
	end

	local r = async()
	if Mode == "execute" then
		exports["oxmysql"]:query(query,Params,function(data)
			r(data or 0)
		end)
	elseif Mode == "scalar" then
		exports["oxmysql"]:scalar(query,Params,function(scalar)
			r(scalar)
		end)
	else
		exports["oxmysql"]:query(query,Params,function(rows)
			r(rows,#rows)
		end)
	end

	return r:wait()
end
-----------------------------------------------------------------------------------------------------------------------------------------
-- ASYNC
-----------------------------------------------------------------------------------------------------------------------------------------
async(function()
	vRP.registerDrivers("oxmysql",onInit,onPrepare,onQuery)
end)